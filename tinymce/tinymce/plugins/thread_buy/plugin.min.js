tinymce.PluginManager.add("thread_buy", function (editor, url) {
    var openDialog = function () {
        return editor.windowManager.open({
            title: "帖子出售",
            body: {
                type: "panel",
                items: [
                    {
                        type: "input",
                        name: "number",
                        label: "金币",
                    },
                    {
                        type: "textarea",
                        name: "detail",
                        label: "内容",
                    },
                ],
            },
            buttons: [
                {
                    type: "cancel",
                    text: "Close",
                },
                {
                    type: "submit",
                    text: "Save",
                    primary: true,
                },
            ],
            onSubmit: function (api) {
                var data = api.getData();
                if (!/^\d+?$/.test(data.number)) {
                    alert("金币请输入数字");
                } else {
                    var number =
                        parseInt(data.number) > 0 ? parseInt(data.number) : 0;
                    // 将输入框内容插入到内容区光标位置
                    editor.insertContent(
                        "[buy price=" + number + "]" + data.detail + "[/buy]"
                    );
                    api.close();
                }
            },
        });
    };

    // 注册一个工具栏按钮名称
    editor.ui.registry.addButton("thread_buy", {
        text: "售",
        tooltip: "发布出售内容",
        onAction: function () {
            openDialog();
        },
    });

    return {
        getMetadata: function () {
            return {
                //插件名和链接会显示在“帮助”→“插件”→“已安装的插件”中
                name: "thread_buy",
                url: "https://webape.net",
            };
        },
    };
});
